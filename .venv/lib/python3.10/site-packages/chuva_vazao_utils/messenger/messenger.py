from datetime import datetime

import pytz

from chuva_vazao_utils.exceptions import MessageTypeError
from chuva_vazao_utils.messenger.message_type import MessageType


class Messenger:

    @staticmethod
    def create_msg(message_type: MessageType, content: str, **kwargs) -> dict:

        if message_type not in MessageType.list():
            raise MessageTypeError

        tz = pytz.timezone('America/Sao_Paulo')
        timestamp = datetime.now(tz=tz).isoformat()

        message = {
            'status_code': message_type.status_code,
            'type': message_type.type,
            'timestamp': timestamp,
            'message': content
        }
        message.update(kwargs)
        return message
