from abc import ABC
from dataclasses import dataclass
from typing import Union

from chuva_vazao_utils.entities.apis.chvz_entity import ChVzEntity, ChVzEntityApi


@dataclass(eq=True, frozen=True)
class Posto(ChVzEntity):
    id_river: int
    cod: str
    name: str
    latitude: float
    longitude: float


class PostoApi(ChVzEntityApi, ABC):
    @classmethod
    def fetch_by_lat_long(cls, latitude: float, longitude: float) -> Union[Posto, None]:
        postos = cls.fetch_all()
        return next(
            (p for p in postos if p.latitude == latitude and p.longitude == longitude), None
        )
