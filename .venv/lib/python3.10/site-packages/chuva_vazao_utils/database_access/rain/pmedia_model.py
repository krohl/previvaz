from chuva_vazao_utils.connection import ChuvaVazaoDatabase
from chuva_vazao_utils.database_access.base.base_api import BaseDatabaseApi
from chuva_vazao_utils.database_access.rain.rain_model import RainModelDatabaseApi
from chuva_vazao_utils.database_access.query_builder import QueryBuilder
from chuva_vazao_utils.entities.rain.pmedia_model import PmediaModel, PmediaModelApi, PmediaModelMenu


class PmediaModelDatabaseApi(BaseDatabaseApi, PmediaModelApi):
    _query_builder = QueryBuilder('pmedia')
    _database = ChuvaVazaoDatabase
    _select_columns = ['id_pmedia', 'limite_dias', 'key_pattern', 'filename_pattern', 'bucket', 'id_modelo_mapa']

    @classmethod
    def from_dict(cls, bd_entity: dict) -> PmediaModel:
        return PmediaModel(
            _id=bd_entity['id_pmedia'],
            limite_dias=bd_entity['limite_dias'],
            key_pattern=bd_entity['key_pattern'],
            filename_pattern=bd_entity['filename_pattern'],
            bucket=bd_entity['bucket'],
            model=RainModelDatabaseApi.fetch_by_id(bd_entity['id_modelo_mapa']),
        )

    @classmethod
    def get_default_select_conditions(cls) -> dict:
        return {'end_date': None}

    @classmethod
    def fetch_model(cls, model: PmediaModelMenu) -> PmediaModel:
        return cls.fetch_by_id(model.value)
