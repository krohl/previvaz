from chuva_vazao_utils.connection import ChuvaVazaoDatabase
from chuva_vazao_utils.database_access.base.base_api import BaseDatabaseApi
from chuva_vazao_utils.database_access.rain.rain_model import RainModelDatabaseApi
from chuva_vazao_utils.database_access.query_builder import QueryBuilder
from chuva_vazao_utils.entities.rain.psat_model import PsatModel, PsatModelApi, PsatModelMenu


class PsatModelDatabaseApi(BaseDatabaseApi, PsatModelApi):
    _query_builder = QueryBuilder('psat')
    _database = ChuvaVazaoDatabase
    _select_columns = ['id_psat', 'key_pattern', 'id_modelo', 'filename_pattern']

    @classmethod
    def from_dict(cls, bd_entity: dict) -> PsatModel:
        return PsatModel(
            _id=bd_entity.get('id_psat'),
            key_pattern=bd_entity.get('key_pattern'),
            filename_pattern=bd_entity.get('filename_pattern'),
            model=RainModelDatabaseApi.fetch_by_id(bd_entity.get('id_modelo')),
        )

    @classmethod
    def get_default_select_conditions(cls) -> dict:
        return {}

    @classmethod
    def fetch_psat_model(cls, model: PsatModelMenu) -> PsatModel:
        return cls.fetch_by_id(model.value)
