from chuva_vazao_utils.connection import ChuvaVazaoDatabase
from chuva_vazao_utils.database_access.base.base_api import BaseDatabaseApi
from chuva_vazao_utils.database_access.rain.rain_model import RainModelDatabaseApi
from chuva_vazao_utils.database_access.query_builder import QueryBuilder
from chuva_vazao_utils.entities.rain.rain_historic import RainHistoric, RainHistoricApi, RainHistoricMenu


class RainHistoricDatabaseApi(BaseDatabaseApi, RainHistoricApi):
    _query_builder = QueryBuilder('historico_precipitacao')
    _database = ChuvaVazaoDatabase
    _select_columns = ['id_historico_precipitacao', 'id_modelo_mapa', '`key`', 'filename_pattern']

    @classmethod
    def from_dict(cls, bd_entity: dict) -> RainHistoric:
        return RainHistoric(
            _id=bd_entity['id_historico_precipitacao'],
            key=bd_entity['key'],
            filename_pattern=bd_entity['filename_pattern'],
            model=RainModelDatabaseApi.fetch_by_id(bd_entity['id_modelo_mapa'])
        )

    @classmethod
    def get_default_select_conditions(cls) -> dict:
        return {}

    @classmethod
    def fetch_rain_historic(cls, model_menu: RainHistoricMenu) -> RainHistoric:
        return cls.fetch_by_id(model_menu.value)
