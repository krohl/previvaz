from chuva_vazao_utils.connection import RiverDatabase
from chuva_vazao_utils.database_access.base.base_api import BaseDatabaseApi
from chuva_vazao_utils.database_access.query_builder import QueryBuilder
from chuva_vazao_utils.entities.rain.posto import Posto, PostoApi


class PostoDatabaseApi(BaseDatabaseApi, PostoApi):
    _query_builder = QueryBuilder('posto')
    _database = RiverDatabase
    _select_columns = ['id_posto', 'id_river', 'cod_posto', 'name_posto', 'latitude', 'longitude']

    @classmethod
    def from_dict(cls, bd_entity: dict) -> Posto:
        return Posto(
            _id=bd_entity.get('id_posto'),
            id_river=bd_entity.get('id_river'),
            cod=bd_entity['cod_posto'],
            name=bd_entity['name_posto'],
            latitude=float(bd_entity['latitude']),
            longitude=float(bd_entity['longitude']),
        )

    @classmethod
    def get_default_select_conditions(cls) -> dict:
        return {'end_date': None}
