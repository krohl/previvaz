from chuva_vazao_utils.connection import ChuvaVazaoDatabase
from chuva_vazao_utils.database_access.base.base_api import BaseDatabaseApi
from chuva_vazao_utils.database_access.query_builder import QueryBuilder
from chuva_vazao_utils.entities.rain.rain_model import BaseRainModel, ForecastRainModel, ObservedRainModel, RainModelApi


class RainModelDatabaseApi(BaseDatabaseApi, RainModelApi):
    _query_builder = QueryBuilder('modelo_mapa')
    _database = ChuvaVazaoDatabase
    _select_columns = ['id_modelo_mapa', '`key`', 'filename_prefix', 'nome', 'apelido', 'is_previsao']

    @classmethod
    def from_dict(cls, bd_entity: dict) -> BaseRainModel:
        if bd_entity['is_previsao']:
            return ForecastRainModel(
                _id=bd_entity['id_modelo_mapa'],
                name=bd_entity['nome'],
                nickname=bd_entity['apelido'],
                key=bd_entity['key'],
                filename_prefix=bd_entity['filename_prefix']
            )
        else:
            return ObservedRainModel(
                _id=bd_entity['id_modelo_mapa'],
                name=bd_entity['nome'],
                nickname=bd_entity['apelido'],
                key=bd_entity['key'],
                filename_prefix=bd_entity['filename_prefix']
            )

    @classmethod
    def get_default_select_conditions(cls) -> dict:
        return {}
