import pytest

from chuva_vazao_utils.aws.s3.pattern_formatter.pattern_formatter import S3PatternFormatter


@pytest.mark.parametrize(
    'formated_string,pattern,expected_result',
    [
        (
            'MERGE-GPM.PMEDIA_20230208.dat',
            'MERGE-GPM.PMEDIA_{data_date_%Y%m%d}.dat',
            {'data_date_%Y%m%d': '20230208'}
        ),
        (
            'NCEP_GEFS_0p5.ETA40.PMEDIA_170223a180223.dat',
            'NCEP_GEFS_0p5.ETA40.PMEDIA_{data_date_%d%m%y}a{target_date_%d%m%y}.dat',
            {'data_date_%d%m%y': '170223', 'target_date_%d%m%y': '180223'}
        )
    ]

)
def test_revert_pattern(formated_string: str, pattern: str, expected_result: dict):
    # When
    decoded_string = S3PatternFormatter._get_formated_string_pattern_params(formated_string, pattern)
    # Then
    assert decoded_string == expected_result
