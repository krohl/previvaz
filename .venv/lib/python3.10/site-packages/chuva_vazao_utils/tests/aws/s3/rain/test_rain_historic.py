import pytest
from datetime import date
from unittest.mock import Mock

from chuva_vazao_utils.aws.s3.rain.rain_historic import RainHistoricFilesS3Api


@pytest.mark.parametrize(
    'filename_pattern,file_date,expected_filename',
    [
        ('file_{date_%d%m%y}.dat', date(2023, 2, 8), 'file_080223.dat'),
        ('file_{date_%d%m%Y}.txt', date(2023, 2, 8), 'file_08022023.txt')
    ]
)
def test_get_data_file(filename_pattern: str, file_date: date, expected_filename: str):
    # Given
    model = Mock(key='mock/key', filename_pattern=filename_pattern)
    # When
    hist_file = RainHistoricFilesS3Api.get_data_file(model, file_date)
    # Then
    assert hist_file.base_path == 'mock/key'
    assert hist_file.filename == expected_filename
    assert hist_file.bucket_name == 'esfera-inteligencia-mapas-precipitacao-mock-bucket'
