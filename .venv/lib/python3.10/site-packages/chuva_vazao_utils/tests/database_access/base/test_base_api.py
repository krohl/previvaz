from unittest.mock import MagicMock

from chuva_vazao_utils.database_access.base.base_api import BaseDatabaseApi


def test_cache(mock_select: MagicMock):
    # Given
    class BaseApiTestApi(BaseDatabaseApi):
        _select_columns = []

        @classmethod
        def get_default_select_conditions(cls):
            pass  # Para permitir o teste

    BaseApiTestApi.fetch_all.cache_clear()
    # When
    BaseApiTestApi.fetch_all()
    BaseApiTestApi.fetch_all()
    # Then
    assert mock_select.call_count == 1
