from unittest.mock import MagicMock

from chuva_vazao_utils.database_access.rain.posto import PostoDatabaseApi
from chuva_vazao_utils.entities.rain.posto import Posto


def test_instantiation():
    # Teste garante que classe pode ser instanciada e nenhum m√©todo abstrato deixou de ser implementado
    PostoDatabaseApi()


def test_fetch_all(mock_select: MagicMock):
    # Given
    mock_select.return_value = [
        {
            'id_posto': 1, 'id_river': 10, 'cod_posto': 'cod_1', 'name_posto': 'posto_1', 'latitude': 1., 'longitude': 1.1
        },
        {
            'id_posto': 2, 'id_river': 20, 'cod_posto': 'cod_2', 'name_posto': 'posto_2', 'latitude': 2., 'longitude': 2.2
        },
    ]
    # When
    postos = PostoDatabaseApi.fetch_all()
    # Then
    assert postos == [
        Posto(_id=1, id_river=10, cod='cod_1', name='posto_1', latitude=1., longitude=1.1),
        Posto(_id=2, id_river=20, cod='cod_2', name='posto_2', latitude=2., longitude=2.2),
    ]
    mock_select.assert_called_once_with(
        ['id_posto', 'id_river', 'cod_posto', 'name_posto', 'latitude', 'longitude'],
        where={'end_date': None}
    )
